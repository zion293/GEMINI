# 프로젝트 'cattytrip' 개발 계획서 v2.1

## 1. 핵심 컨셉 (Core Concept)

**"AI 채팅과 지도가 실시간으로 연동되는 지능형 여행 플래너"**

사용자가 AI와 자연스럽게 대화하여 여행 계획을 요청하면, 그 결과가 즉시 지도 위에 시각적으로 그려지는 인터랙티브 서비스를 구축한다.

---

## 2. 기능 목록 (Features)

### AI 채팅 핵심 기능
- **자연어 이해:** 사용자의 여행 관련 요청(계획, 수정, 질문)을 이해하고 맥락을 유지하며 대화를 지속한다.
- **여행 계획 생성 및 추천:** 목적지, 기간, 예산, 취향(예: "고양이 동반 가능") 등 복합적인 요구사항을 반영하여 최적의 여행 일정을 추천한다.
- **실시간 계획 수정:** "해운대 빼고 다른 곳 추천해줘", "1일차랑 2일차 순서 바꿔줘" 등 대화형 명령어를 통해 기존 계획을 유연하게 수정한다.
- **정보 관리:** 예산, 예약, 준비물 등의 정보를 대화를 통해 등록하고 조회한다.

### 지도 연동 기능
- **실시간 시각화:** 채팅을 통해 계획된 모든 장소는 즉시 지도 위에 핀으로 표시된다.
- **경로 표시:** 계획된 일정 순서에 따라 핀들을 선으로 연결하여 전체적인 여행 루트를 보여준다.
- **인터랙티브 핀:** 지도 위의 핀을 클릭하면 해당 장소의 상세 정보(사진, 평점 등)를 확인하고 빠른 작업을 수행할 수 있다.

---

## 3. 아키텍처 및 화면 흐름 (Architecture & Flow)

### 화면 구성: 2단 분할 (Split View) SPA
- **왼쪽 패널 (70%):** **Google Map View**. 모든 시각적 정보(핀, 경로)가 표시되는 메인 화면.
- **오른쪽 패널 (30%):** **AI Chat View**. 사용자와 AI가 대화하는 인터페이스.

### 핵심 동작 흐름
1.  **사용자:** 채팅창에 메시지 입력 (`"부산 3박 4일 여행 짜줘"`)
2.  **프론트엔드 (Next.js):** 메시지를 백엔드 API로 전송
3.  **백엔드 (Next.js API Routes):**
    a. DB에서 이전 대화 기록 조회 (맥락 파악용)
    b. 현재 메시지 + 대화 기록을 **외부 AI API (Gemini/GPT)** 로 전달
    c. AI가 생성한 계획(JSON)과 답변(텍스트)을 수신
    d. 계획 데이터를 DB에 저장 (여행, 장소, 위도/경도 등)
    e. 답변 텍스트를 프론트엔드로 전송
4.  **프론트엔드 UI 업데이트:**
    a. 채팅창에 AI의 답변 메시지 표시
    b. 지도에 DB에 새로 저장된 장소의 핀과 경로를 렌더링

---

## 4. 데이터 설계 (Data Schema)

- **User:** `id`, `email`, `password`, `nickname`
- **Trip:** `id`, `userId`, `title`, `startDate`, `endDate`, `total_budget`
- **Destination:** `id`, `tripId`, `name`, `latitude`, `longitude`, `day`, `order`, `memo`
- **Expense:** `id`, `tripId`, `category`, `content`, `amount`
- **Reservation:** `id`, `tripId`, `category`, `confirmationNum`, `details`
- **ChecklistItem:** `id`, `tripId`, `item`, `isChecked`
- **ChatHistory:** `id`, `tripId`, `role` (`user` or `ai`), `content`

---

## 5. 사용자 경험 상세 (UX Details)

- **호버-하이라이트 연동:**
  - **개념:** 채팅창의 장소 이름과 지도의 핀, 지도의 핀과 채팅창의 메시지가 마우스 호버 시 서로를 하이라이트하여 시각적 연결성을 극대화한다.
  - **구현:** React의 중앙 상태(`useState`, `useContext` 등)로 `highlightedId`를 관리. 채팅 컴포넌트와 지도 컴포넌트가 이 상태를 구독하여, 상태 변경 시 각자 UI(CSS, 마커 아이콘)를 업데이트하는 방식으로 구현. 구글맵 API의 마커 아이콘 변경 및 이벤트 리스너 기능을 활용하면 기술적으로 완벽히 구현 가능하다.
- **AI 페르소나:** '캐티(Catty)'라는 이름의 재치 있는 고양이 여행 집사 컨셉으로 친근감 형성.
- **선제적 제안:** 사용자가 미처 생각지 못한 부분(예: 숙소 예약, 준비물)을 AI가 먼저 제안하여 비서 경험 제공.
- **인터랙티브 UI:** 채팅창의 일정은 드래그 앤 드롭으로 순서 변경이 가능하게 하고, 지도에 즉시 반영.
- **지능적인 로딩/피드백:** AI가 생각하는 동안 귀여운 애니메이션을 보여주고, 모든 사용자 행동에 대해 즉각적인 시각적 피드백을 제공하여 앱이 살아있음을 느끼게 한다.
